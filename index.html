<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The Last Circle</title>

<style>
  body {
    margin: 0;
    background: #111;
    color: #fff;
    font-family: Arial, sans-serif;

    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 24px;
  }

  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Title */
  h1 {
    margin: 0 0 28px 0;
    font-size: 42px;
    font-weight: bold;
    letter-spacing: 2px;
    text-align: center;
    white-space: nowrap;
    color: #fff;
  }

  /* 3-column layout */
  .main {
    display: flex;
    align-items: flex-start;
    gap: 28px;
  }

  /* Generic panel */
  .panel {
    background: #0b0b0b;
    padding: 18px;
    border-radius: 6px;
  }

  /* RULES PANEL (RED) */
  .rules {
    width: 320px;
    border: 2px solid #ff2e2e; /* RED */
  }

  .rules h2,
  .tally h2 {
    margin: 0 0 12px 0;
    font-size: 18px;
    letter-spacing: 1px;
    color: #fff;
  }

  .rules ul {
    margin: 0;
    padding-left: 18px;
    line-height: 1.55;
    color: #ddd;
    font-size: 14px;
  }

  .rules li {
    margin-bottom: 10px;
  }

  /* GAME */
  .game {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .board {
    display: flex;
    flex-direction: column;
    gap: 22px;
    margin-bottom: 32px;
    align-items: flex-start;
  }

  .row {
    display: flex;
    gap: 16px;
  }

  /* Circles (still lime green) */
  .circle {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: 3px solid #39ff14;
    background: transparent;
    cursor: pointer;
  }

  .circle.filled {
    background: #39ff14;
  }

  .controls {
    display: flex;
    gap: 16px;
    justify-content: center;
  }

  button {
    padding: 14px 22px;
    font-size: 16px;
    cursor: pointer;
    background: #0f3d0f;
    color: #fff;
    border: 2px solid #39ff14;
    border-radius: 4px;
  }

  button:hover {
    background: #145214;
  }

  /* HOST RECORD (RED) */
  .tally {
    width: 260px;
    text-align: center;
    border: 2px solid #ff2e2e; /* RED */
  }

  .scoreline {
    display: flex;
    justify-content: center;
    gap: 14px;
    margin: 8px 0 16px;
    font-size: 20px;
    font-weight: bold;
  }

  .scorebox {
    border: 2px solid #ff2e2e; /* RED */
    padding: 10px 12px;
    border-radius: 6px;
    min-width: 90px;
    background: #0f0f0f;
  }

  .scorebox span {
    display: block;
    font-size: 12px;
    font-weight: normal;
    color: #bbb;
    margin-top: 6px;
    letter-spacing: 1px;
  }

  .tally-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
  }

  .small {
    padding: 12px 16px;
    font-size: 15px;
  }

  .reset {
    background: #2a2a2a;
    border-color: #ff2e2e;
  }

  .reset:hover {
    background: #3a3a3a;
  }

  .hint {
    margin-top: 12px;
    font-size: 12px;
    color: #bbb;
    line-height: 1.4;
  }

  /* Mobile stacking */
  @media (max-width: 980px) {
    .main {
      flex-direction: column;
      align-items: center;
    }

    .rules,
    .tally {
      width: min(520px, 92vw);
      text-align: left;
    }

    .tally {
      text-align: center;
    }
  }
</style>
</head>

<body>

<div class="container">
  <h1>THE LAST CIRCLE</h1>

  <div class="main">
    <!-- RULES -->
    <div class="panel rules">
      <h2>RULES</h2>
      <ul>
        <li>Players take turns.</li>
        <li>Choose <strong>one row</strong> per turn.</li>
        <li>Remove <strong>one or more</strong> circles from that row.</li>
        <li>You may only play in <strong>one row per turn</strong>.</li>
        <li>The player who takes the <strong>last circle loses</strong>.</li>
      </ul>
    </div>

    <!-- GAME -->
    <div class="game">
      <div id="board" class="board"></div>

      <div class="controls">
        <button id="undo">Undo</button>
        <button id="clear">Clear</button>
        <button id="restart">Restart</button>
      </div>
    </div>

    <!-- HOST RECORD -->
    <div class="panel tally">
      <h2>HOST RECORD</h2>

      <div class="scoreline">
        <div class="scorebox">
          <div id="wins">0</div>
          <span>WINS</span>
        </div>
        <div class="scorebox">
          <div id="losses">0</div>
          <span>LOSSES</span>
        </div>
      </div>

      <div class="tally-buttons">
        <button id="winBtn" class="small">+ Win</button>
        <button id="lossBtn" class="small">+ Loss</button>
        <button id="resetRecordBtn" class="small reset">Reset Record</button>
      </div>

      <div class="hint">
        Record is saved locally on this device.
      </div>
    </div>
  </div>
</div>

<script>
  /* -------- GAME BOARD -------- */
  const ROWS = [3, 4, 5, 6];
  let state = [];
  let history = [];

  const board = document.getElementById("board");
  const undoBtn = document.getElementById("undo");
  const clearBtn = document.getElementById("clear");
  const restartBtn = document.getElementById("restart");

  function copyState() {
    return state.map(row => [...row]);
  }

  function initBoard() {
    state = ROWS.map(n => Array(n).fill(false));
    history = [];
    render();
  }

  function render() {
    board.innerHTML = "";
    state.forEach((row, r) => {
      const rowDiv = document.createElement("div");
      rowDiv.className = "row";

      row.forEach((filled, c) => {
        const circle = document.createElement("div");
        circle.className = "circle" + (filled ? " filled" : "");
        circle.onclick = () => {
          history.push(copyState());
          state[r][c] = !state[r][c];
          render();
        };
        rowDiv.appendChild(circle);
      });

      board.appendChild(rowDiv);
    });
  }

  undoBtn.onclick = () => {
    if (history.length) {
      state = history.pop();
      render();
    }
  };

  clearBtn.onclick = () => {
    history.push(copyState());
    state = state.map(row => row.map(() => false));
    render();
  };

  restartBtn.onclick = initBoard;

  /* -------- HOST RECORD -------- */
  const STORAGE_KEY = "last_circle_host_record";
  const winsEl = document.getElementById("wins");
  const lossesEl = document.getElementById("losses");

  function loadRecord() {
    try {
      return JSON.parse(localStorage.getItem(STORAGE_KEY)) || { wins: 0, losses: 0 };
    } catch {
      return { wins: 0, losses: 0 };
    }
  }

  function saveRecord(rec) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(rec));
  }

  let record = loadRecord();
  winsEl.textContent = record.wins;
  lossesEl.textContent = record.losses;

  document.getElementById("winBtn").onclick = () => {
    record.wins++;
    saveRecord(record);
    winsEl.textContent = record.wins;
  };

  document.getElementById("lossBtn").onclick = () => {
    record.losses++;
    saveRecord(record);
    lossesEl.textContent = record.losses;
  };

  document.getElementById("resetRecordBtn").onclick = () => {
    record = { wins: 0, losses: 0 };
    saveRecord(record);
    winsEl.textContent = 0;
    lossesEl.textContent = 0;
  };

  initBoard();
</script>

</body>
</html>
